---
import Layout from "../layouts/Layout.astro";
import Navigation from "../components/navigation.astro";
import Welcome from "../components/welcome.astro";
import { supabase } from "../lib/supabase.js";

const { data: posts, error } = await supabase
  .from("posts")
  .select("id, title, content, created_at")
  .order("created_at", { ascending: false })
  .limit(5);
---

<Layout title="JuanMataku Blog">
  <Navigation />
  <Welcome />

  <section class="panel">
    <h2>Latest 5 posts</h2>

    {error && <p>Error: {error.message}</p>}

    {posts && posts.length > 0 ? (
      <ul>
        {posts.map((post) => (
          <li>
            <h3>{post.title}</h3>
            <small>{new Date(post.created_at).toLocaleDateString()}</small>
            <p>{post.content}</p>
          </li>
        ))}
      </ul>
    ) : (
      <p>No posts yet.</p>
    )}
  </section>
</Layout>
